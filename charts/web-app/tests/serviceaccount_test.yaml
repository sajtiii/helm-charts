suite: ServiceAccount
templates:
  - serviceaccount.yaml

tests:
  - it: should always create a ServiceAccount
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - isKind:
          of: ServiceAccount

  - it: should use app name as default service account name
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - equal:
          path: metadata.name
          value: myapp

  - it: should use release name when no app name is set
    set:
      image.repository: nginx
    release:
      name: my-release
    asserts:
      - equal:
          path: metadata.name
          value: my-release

  - it: should use custom name when serviceAccount.name is set
    set:
      name: myapp
      image.repository: nginx
      serviceAccount.name: my-custom-sa
    asserts:
      - equal:
          path: metadata.name
          value: my-custom-sa

  - it: should add annotations when specified
    set:
      name: myapp
      image.repository: nginx
      serviceAccount.annotations:
        iam.amazonaws.com/role: arn:aws:iam::123456789:role/my-role
    asserts:
      - equal:
          path: metadata.annotations["iam.amazonaws.com/role"]
          value: arn:aws:iam::123456789:role/my-role

  - it: should not have annotations section when none specified
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - isNull:
          path: metadata.annotations

  - it: should have app label set to app name
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - equal:
          path: metadata.labels.app
          value: myapp
