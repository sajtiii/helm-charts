suite: pdb
templates:
  - templates/pdb.yaml
tests:
  - it: should render PDB by default
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - isKind:
          of: PodDisruptionBudget
      - isAPIVersion:
          of: policy/v1
      - equal:
          path: metadata.name
          value: web-app-myapp
      - equal:
          path: spec.minAvailable
          value: 50%
      - equal:
          path: spec.selector.matchLabels.app
          value: web-app-myapp

  - it: should not render when pdb is false
    set:
      name: myapp
      image.repository: nginx
      pdb: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should set custom minAvailable
    set:
      name: myapp
      image.repository: nginx
      pdb.minAvailable: 1
    asserts:
      - equal:
          path: spec.minAvailable
          value: 1

  - it: should include maxUnavailable when set
    set:
      name: myapp
      image.repository: nginx
      pdb.maxUnavailable: 1
    asserts:
      - equal:
          path: spec.maxUnavailable
          value: 1
