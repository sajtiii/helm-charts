suite: pvc
templates:
  - templates/pvc.yaml
tests:
  - it: should not render when volumes is empty
    set:
      name: myapp
      image.repository: nginx
    asserts:
      - hasDocuments:
          count: 0

  - it: should render PVC for a volume
    set:
      name: myapp
      image.repository: nginx
      volumes:
        - name: data
          target: /data
          size: 1Gi
    asserts:
      - isKind:
          of: PersistentVolumeClaim
      - isAPIVersion:
          of: v1
      - equal:
          path: metadata.name
          value: web-app-myapp-volume-data
      - equal:
          path: spec.resources.requests.storage
          value: 1Gi
      - equal:
          path: spec.accessModes[0]
          value: ReadWriteMany

  - it: should use default storage class
    set:
      name: myapp
      image.repository: nginx
      volumes:
        - name: data
          target: /data
          size: 1Gi
    asserts:
      - equal:
          path: spec.storageClassName
          value: default

  - it: should use custom storage class
    set:
      name: myapp
      image.repository: nginx
      volumes:
        - name: data
          target: /data
          size: 2Gi
          storageClass: fast
    asserts:
      - equal:
          path: spec.storageClassName
          value: fast

  - it: should use default volume mode
    set:
      name: myapp
      image.repository: nginx
      volumes:
        - name: data
          target: /data
          size: 1Gi
    asserts:
      - equal:
          path: spec.volumeMode
          value: Filesystem
